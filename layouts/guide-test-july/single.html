{{ define "main" }}

  {{ $blocks := slice }}

  {{ if not site.Params.env_bookshop_live }}
    {{ $sitewideComponents := slice }}
    {{ $sitewideComponent := "" }}

    {{ range .Params.content_blocks }}
      {{ if .is_sitewide }}
        {{ $sitewideSection := .sitewide_section }}
        {{ $sitewideComponents = site.Data.sitewide_components.sitewide_components.content_blocks }}
        {{ range $sitewideComponents }}
          {{ if eq .uuid $sitewideSection }}
            {{ $blocks = $blocks | append . }}
          {{ end }}
        {{ end }}
      {{ else }}
        {{ $blocks = $blocks | append . }}
      {{ end }}
    {{ end }}
  {{ else }}
    {{ $blocks = .Params.content_blocks }}
  {{ end }}

  {{ partial "bookshop_bindings" `(dict "topper" .Params.topper "blocks" .Params.content_blocks)` }}
  {{ partial "bookshop_partial" (slice "page-guide-test-july" (dict "topper" .Params.topper "blocks" $blocks)) }}
  
{{ end }}